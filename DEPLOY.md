# å¾®ä¿¡äº‘å¼€å‘éƒ¨ç½²æŒ‡å—

## ğŸ“‹ éƒ¨ç½²å‰å‡†å¤‡

### 1. ç”³è¯·å¾®ä¿¡å°ç¨‹åº
1. è®¿é—® [å¾®ä¿¡å…¬ä¼—å¹³å°](https://mp.weixin.qq.com/)
2. æ³¨å†Œå°ç¨‹åºè´¦å·ï¼ˆä¸ªäººæˆ–ä¼ä¸šï¼‰
3. è·å–å°ç¨‹åº AppID

### 2. å¼€é€šäº‘å¼€å‘
1. åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­åˆ›å»ºäº‘å¼€å‘ç¯å¢ƒ
2. è®°å½•äº‘ç¯å¢ƒ IDï¼ˆä¾‹å¦‚ï¼šprod-8g0iq9bwb972a467ï¼‰

### 3. å®‰è£…å¼€å‘å·¥å…·
- [å¾®ä¿¡å¼€å‘è€…å·¥å…·](https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html)
- Node.js ç¯å¢ƒ

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### Step 1: é…ç½®é¡¹ç›®
1. ä¿®æ”¹ `project.config.json` ä¸­çš„ `appid` ä¸ºä½ çš„å°ç¨‹åº AppID
2. ä¿®æ”¹ `miniprogram/app.js` ä¸­çš„äº‘ç¯å¢ƒ ID

```javascript
wx.cloud.init({
  env: 'your-cloud-env-id', // æ›¿æ¢ä¸ºä½ çš„äº‘ç¯å¢ƒID
  traceUser: true,
});
```

### Step 2: åˆ›å»ºæ•°æ®åº“é›†åˆ
åœ¨å¾®ä¿¡äº‘å¼€å‘æ§åˆ¶å°åˆ›å»ºä»¥ä¸‹æ•°æ®åº“é›†åˆï¼š
- `users` - ç”¨æˆ·è¡¨
- `repair_records` - ç»´ä¿®è®°å½•è¡¨
- `permission_applications` - æƒé™ç”³è¯·è¡¨
- `inspection_records` - è®¾å¤‡ç‚¹æ£€è®°å½•è¡¨
- `maintenance_records` - ä¿å…»è®°å½•è¡¨
- `task_transfers` - ä»»åŠ¡è½¬åŠè®°å½•è¡¨
- `role_changes` - è§’è‰²å˜æ›´è®°å½•è¡¨

è¯¦ç»†æ•°æ®åº“ç»“æ„å‚è€ƒ `database-init.md`

### Step 3: éƒ¨ç½²äº‘å‡½æ•°
1. åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­æ‰“å¼€é¡¹ç›®
2. å³é”®ç‚¹å‡» `cloudfunctions` æ–‡ä»¶å¤¹
3. é€‰æ‹©"åŒæ­¥äº‘å‡½æ•°åˆ—è¡¨"
4. åˆ†åˆ«å³é”®ç‚¹å‡»æ¯ä¸ªäº‘å‡½æ•°æ–‡ä»¶å¤¹ï¼Œé€‰æ‹©"ä¸Šä¼ å¹¶éƒ¨ç½²"ï¼š
   - `getOpenId`
   - `repairManager`
   - `userManager`

### Step 4: è®¾ç½®æ•°æ®åº“æƒé™
åœ¨äº‘å¼€å‘æ§åˆ¶å° > æ•°æ®åº“ > é›†åˆæƒé™ä¸­è®¾ç½®ï¼š

```json
// users é›†åˆæƒé™
{
  "read": "auth.openid == doc.openid || get('users', auth.openid).role == 'admin'",
  "write": "get('users', auth.openid).role == 'admin'"
}

// repair_records é›†åˆæƒé™
{
  "read": "auth.openid == doc.reporterOpenid || auth.openid == doc.assignedTo || get('users', auth.openid).role == 'admin'",
  "write": "auth.openid == doc.reporterOpenid || auth.openid == doc.assignedTo || get('users', auth.openid).role == 'admin'"
}

// permission_applications é›†åˆæƒé™
{
  "read": "auth.openid == doc.applicantOpenid || get('users', auth.openid).role == 'admin'",
  "write": "get('users', auth.openid).role == 'admin'"
}
```

### Step 5: åˆ›å»ºåˆå§‹ç®¡ç†å‘˜
åœ¨æ•°æ®åº“ `users` é›†åˆä¸­æ‰‹åŠ¨æ·»åŠ ç®¡ç†å‘˜è®°å½•ï¼š

```json
{
  "openid": "ä½ çš„å¾®ä¿¡OpenID",
  "name": "ç³»ç»Ÿç®¡ç†å‘˜",
  "role": "admin",
  "department": "ITéƒ¨",
  "phone": "13800138000",
  "employeeCode": "ADMIN001",
  "status": "active",
  "createTime": "2024-01-01T00:00:00.000Z",
  "updateTime": "2024-01-01T00:00:00.000Z"
}
```

### Step 6: æµ‹è¯•éƒ¨ç½²
1. åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­é¢„è§ˆå°ç¨‹åº
2. æµ‹è¯•å„é¡¹åŠŸèƒ½ï¼š
   - ç”¨æˆ·ç™»å½•å’Œè§’è‰²è¯†åˆ«
   - æ•…éšœæŠ¥ä¿®åŠŸèƒ½
   - æƒé™ç”³è¯·åŠŸèƒ½
   - ç»´ä¿®ä»»åŠ¡ç®¡ç†
   - ç®¡ç†å‘˜å®¡æ ¸åŠŸèƒ½

## ğŸ“± åŠŸèƒ½ç‰¹æ€§

### âœ… å·²å®ç°åŠŸèƒ½
- ğŸ” åŸºäºå¾®ä¿¡OpenIDçš„ç”¨æˆ·èº«ä»½è¯†åˆ«
- ğŸ‘¥ ä¸‰ç§è§’è‰²æƒé™ç®¡ç†ï¼ˆæ™®é€šç”¨æˆ·/ç»´ä¿®äººå‘˜/ç®¡ç†å‘˜ï¼‰
- ğŸ”§ è®¾å¤‡æ•…éšœæŠ¥ä¿®ç³»ç»Ÿ
- ğŸ“‹ ç»´ä¿®ä»»åŠ¡è·Ÿè¸ªå’Œç®¡ç†
- âœ… è®¾å¤‡ç‚¹æ£€è®°å½•
- âš™ï¸ è®¾å¤‡ä¿å…»ç®¡ç†
- ğŸ”„ ä»»åŠ¡è½¬åŠåŠŸèƒ½
- ğŸ“ æƒé™ç”³è¯·å’Œå®¡æ ¸
- ğŸ“Š ç»Ÿè®¡æ•°æ®å±•ç¤º
- ğŸ”” å®æ—¶æ•°æ®åŒæ­¥

### ğŸ¯ æ ¸å¿ƒä¸šåŠ¡æµç¨‹
1. **æŠ¥ä¿®æµç¨‹**ï¼šç”¨æˆ·æäº¤æŠ¥ä¿® â†’ è‡ªåŠ¨åˆ†é…ç»´ä¿®å‘˜ â†’ ç»´ä¿®å¤„ç† â†’ å®Œæˆç¡®è®¤
2. **æƒé™ç”³è¯·**ï¼šç”¨æˆ·ç”³è¯·æƒé™ â†’ ç®¡ç†å‘˜å®¡æ ¸ â†’ è§’è‰²å˜æ›´ â†’ æƒé™ç”Ÿæ•ˆ
3. **ä»»åŠ¡ç®¡ç†**ï¼šä»»åŠ¡åˆ†é… â†’ çŠ¶æ€æ›´æ–° â†’ è½¬åŠå¤„ç† â†’ å®Œæˆè®°å½•

## ğŸ› ï¸ æŠ€æœ¯æ¶æ„

### å‰ç«¯æŠ€æœ¯
- å¾®ä¿¡å°ç¨‹åºåŸç”Ÿå¼€å‘
- WXML + WXSS + JavaScript
- å¾®ä¿¡äº‘å¼€å‘ SDK

### åç«¯æŠ€æœ¯
- å¾®ä¿¡äº‘å¼€å‘
- Node.js äº‘å‡½æ•°
- äº‘æ•°æ®åº“
- äº‘å­˜å‚¨ï¼ˆç”¨äºå›¾ç‰‡ä¸Šä¼ ï¼‰

### æ•°æ®åº“è®¾è®¡
- åŸºäºæ–‡æ¡£å‹æ•°æ®åº“
- å®Œæ•´çš„æƒé™æ§åˆ¶
- æ•°æ®å…³è”å’Œç´¢å¼•ä¼˜åŒ–

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡
```javascript
// app.js
const ENV_CONFIG = {
  development: 'dev-env-id',
  production: 'prod-8g0iq9bwb972a467'
}
```

### æƒé™é…ç½®
```javascript
// è§’è‰²æƒé™å®šä¹‰
const ROLE_PERMISSIONS = {
  user: ['repair', 'view_own', 'inspection'],
  maintainer: ['repair', 'view_assigned', 'maintenance', 'update_status'],
  admin: ['all']
}
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### æ•°æ®åº“ä¼˜åŒ–
- åˆç†çš„ç´¢å¼•è®¾è®¡
- åˆ†é¡µæŸ¥è¯¢
- æ•°æ®ç¼“å­˜ç­–ç•¥

### å°ç¨‹åºä¼˜åŒ–
- æŒ‰éœ€åŠ è½½
- å›¾ç‰‡å‹ç¼©
- ä»£ç åˆ†åŒ…

## ğŸ”’ å®‰å…¨è€ƒè™‘

### æ•°æ®å®‰å…¨
- åŸºäºOpenIDçš„èº«ä»½éªŒè¯
- æ•°æ®åº“æƒé™ä¸¥æ ¼æ§åˆ¶
- æ•æ„Ÿä¿¡æ¯åŠ å¯†å­˜å‚¨

### æ¥å£å®‰å…¨
- äº‘å‡½æ•°æƒé™éªŒè¯
- å‚æ•°æ ¡éªŒå’Œè¿‡æ»¤
- æ“ä½œæ—¥å¿—è®°å½•

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### å¸¸è§é—®é¢˜
1. **äº‘å‡½æ•°è°ƒç”¨å¤±è´¥**ï¼šæ£€æŸ¥äº‘ç¯å¢ƒIDé…ç½®å’Œäº‘å‡½æ•°éƒ¨ç½²çŠ¶æ€
2. **æ•°æ®åº“æƒé™é”™è¯¯**ï¼šç¡®è®¤æƒé™è§„åˆ™é…ç½®æ­£ç¡®
3. **ç”¨æˆ·è§’è‰²ä¸æ­£ç¡®**ï¼šæ£€æŸ¥ç”¨æˆ·è¡¨ä¸­çš„è§’è‰²å­—æ®µ

### è”ç³»æ–¹å¼
- å¼€å‘æ–‡æ¡£ï¼š[å¾®ä¿¡å°ç¨‹åºäº‘å¼€å‘æ–‡æ¡£](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/basis/getting-started.html)
- æŠ€æœ¯ç¤¾åŒºï¼šå¾®ä¿¡å¼€å‘è€…ç¤¾åŒº

## ğŸ”„ ç‰ˆæœ¬æ›´æ–°

### v3.0 - äº‘å¼€å‘ç‰ˆæœ¬
- âœ… å®Œæ•´çš„å¾®ä¿¡äº‘å¼€å‘æ¶æ„
- âœ… çœŸå®çš„æ•°æ®åº“å­˜å‚¨
- âœ… å®Œå–„çš„æƒé™ç®¡ç†ç³»ç»Ÿ
- âœ… ç§»åŠ¨ç«¯åŸç”Ÿä½“éªŒ

### åç»­è®¡åˆ’
- ğŸ“± æ”¯æŒå¾®ä¿¡å…¬ä¼—å·H5ç‰ˆæœ¬
- ğŸ”” æ¶ˆæ¯æ¨é€å’Œé€šçŸ¥
- ğŸ“Š æ›´ä¸°å¯Œçš„æ•°æ®åˆ†æ
- ğŸ·ï¸ äºŒç»´ç æ‰«æåŠŸèƒ½
- ğŸ“ æ–‡ä»¶ä¸Šä¼ å’Œç®¡ç†

---

ğŸ‰ **æ­å–œï¼æ‚¨çš„è®¾å¤‡ç»´ä¿®ç®¡ç†ç³»ç»Ÿäº‘å¼€å‘ç‰ˆæœ¬å·²ç»å‡†å¤‡å°±ç»ªï¼** 