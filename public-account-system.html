<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è®¾å¤‡ç»´ä¿®ç®¡ç†ç³»ç»Ÿ</title>
    <script src="https://res.wx.qq.com/open/js/jweixin-1.6.0.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f7f7f7;
            color: #333;
        }
        
        /* å¤´éƒ¨æ ·å¼ */
        .header {
            background: linear-gradient(135deg, #1aad19, #26c91a);
            color: white;
            padding: 20px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .header h1 { font-size: 18px; margin-bottom: 5px; }
        .header .subtitle { font-size: 14px; opacity: 0.9; }
        
        /* å®¹å™¨æ ·å¼ */
        .container { max-width: 414px; margin: 0 auto; background: white; min-height: 100vh; }
        .content { padding: 20px; }
        
        /* è§’è‰²é€‰æ‹©é¡µé¢ */
        .role-selection {
            text-align: center;
            padding: 40px 20px;
        }
        
        .role-selection h2 {
            font-size: 20px;
            margin-bottom: 10px;
            color: #333;
        }
        
        .role-description {
            color: #666;
            margin-bottom: 30px;
            line-height: 1.5;
        }
        
        .role-cards {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .role-card {
            background: white;
            border: 2px solid #e5e5e5;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .role-card:hover, .role-card.selected {
            border-color: #1aad19;
            background: #f8fff8;
            transform: translateY(-2px);
        }
        
        .role-icon {
            font-size: 32px;
            margin-bottom: 10px;
            display: block;
        }
        
        .role-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 8px;
            color: #333;
        }
        
        .role-desc {
            font-size: 14px;
            color: #666;
            line-height: 1.4;
        }
        
        /* æŒ‰é’®æ ·å¼ */
        .btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: #1aad19;
            color: white;
        }
        
        .btn-primary:hover {
            background: #158a15;
        }
        
        .btn-secondary {
            background: #f8f9fa;
            color: #666;
            border: 1px solid #e5e5e5;
        }
        
        /* ä¸»ç•Œé¢æ ·å¼ */
        .user-info {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .user-info h3 {
            color: #1aad19;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .user-detail {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        .user-detail .label { color: #666; }
        .user-detail .value { color: #333; font-weight: 500; }
        
        /* åŠŸèƒ½å¡ç‰‡ */
        .function-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .function-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .function-card:active {
            transform: scale(0.95);
        }
        
        .function-icon {
            font-size: 28px;
            margin-bottom: 10px;
            display: block;
        }
        
        .function-title {
            font-size: 14px;
            color: #333;
            font-weight: 500;
        }
        
        /* ç»Ÿè®¡å¡ç‰‡ */
        .stats-section {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .stats-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #1aad19;
            display: block;
        }
        
        .stat-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        
        /* è¡¨å•æ ·å¼ */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
        }
        
        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #e5e5e5;
            border-radius: 8px;
            font-size: 14px;
            background: white;
        }
        
        .form-textarea {
            min-height: 80px;
            resize: vertical;
        }
        
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #1aad19;
            box-shadow: 0 0 0 2px rgba(26, 173, 25, 0.1);
        }
        
        /* åˆ—è¡¨æ ·å¼ */
        .list-section {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .list-header {
            background: #f8f9fa;
            padding: 15px 20px;
            border-bottom: 1px solid #e5e5e5;
            font-weight: bold;
            color: #333;
        }
        
        .list-item {
            padding: 15px 20px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        
        .list-item:last-child {
            border-bottom: none;
        }
        
        .list-item:hover {
            background: #f8f9fa;
        }
        
        .item-title {
            font-weight: 500;
            margin-bottom: 5px;
            color: #333;
        }
        
        .item-desc {
            font-size: 12px;
            color: #666;
            line-height: 1.4;
        }
        
        .item-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 8px;
            font-size: 12px;
        }
        
        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }
        
        .status-pending { background: #fff3cd; color: #856404; }
        .status-processing { background: #d4edda; color: #155724; }
        .status-completed { background: #d1ecf1; color: #0c5460; }
        .status-urgent { background: #f8d7da; color: #721c24; }
        
        /* å¼¹çª—æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.show {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            margin: 20px;
            max-width: 350px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            padding: 20px 20px 0;
            text-align: center;
        }
        
        .modal-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .modal-footer {
            padding: 0 20px 20px;
            display: flex;
            gap: 10px;
        }
        
        /* åº•éƒ¨å¯¼èˆª */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 414px;
            background: white;
            border-top: 1px solid #e5e5e5;
            display: flex;
            z-index: 100;
        }
        
        .nav-item {
            flex: 1;
            text-align: center;
            padding: 10px 5px;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        
        .nav-item.active {
            background: #f8fff8;
            color: #1aad19;
        }
        
        .nav-icon {
            font-size: 20px;
            display: block;
            margin-bottom: 5px;
        }
        
        .nav-label {
            font-size: 11px;
        }
        
        /* éšè—ç±» */
        .hidden { display: none; }
        
        /* ç©ºçŠ¶æ€ */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }
        
        .empty-state .icon {
            font-size: 48px;
            margin-bottom: 15px;
            opacity: 0.5;
        }
        
        /* å“åº”å¼ */
        @media (max-width: 375px) {
            .function-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- å¤´éƒ¨ -->
        <div class="header">
            <h1>ğŸ”§ è®¾å¤‡ç»´ä¿®ç®¡ç†ç³»ç»Ÿ</h1>
            <div class="subtitle" id="headerSubtitle">å¾®ä¿¡å…¬ä¼—å·ç‰ˆ</div>
        </div>

        <!-- è§’è‰²é€‰æ‹©é¡µé¢ -->
        <div id="roleSelectionPage" class="content">
            <div class="role-selection">
                <h2>ğŸ‘‹ æ¬¢è¿ä½¿ç”¨è®¾å¤‡ç»´ä¿®ç®¡ç†ç³»ç»Ÿ</h2>
                <div class="role-description">
                    è¯·é€‰æ‹©æ‚¨çš„è§’è‰²ç±»å‹ï¼Œç³»ç»Ÿå°†ä¸ºæ‚¨å±•ç¤ºç›¸åº”çš„åŠŸèƒ½æ¨¡å—
                </div>
                
                <div class="role-cards">
                    <div class="role-card" onclick="selectRole('user')">
                        <span class="role-icon">ğŸ‘¨â€ğŸ’¼</span>
                        <div class="role-title">æ™®é€šç”¨æˆ·ï¼ˆè®¾å¤‡æ“ä½œå‘˜ï¼‰</div>
                        <div class="role-desc">è®¾å¤‡æ•…éšœæŠ¥ä¿®ã€æŸ¥çœ‹ç»´ä¿®è¿›åº¦ã€è®¾å¤‡ç‚¹æ£€è®°å½•ã€ç”³è¯·æƒé™å‡çº§</div>
                    </div>
                    
                    <div class="role-card" onclick="selectRole('maintainer')">
                        <span class="role-icon">ğŸ”§</span>
                        <div class="role-title">ç»´ä¿®äººå‘˜</div>
                        <div class="role-desc">å¤„ç†ç»´ä¿®ä»»åŠ¡ã€ç®¡ç†ç»´ä¿®å·¥ä½œã€æ›´æ–°ä»»åŠ¡çŠ¶æ€ã€è½¬åŠä»»åŠ¡ç»™å…¶ä»–ç»´ä¿®å‘˜</div>
                    </div>
                    
                    <div class="role-card" onclick="selectRole('admin')">
                        <span class="role-icon">ğŸ‘¨â€ğŸ’»</span>
                        <div class="role-title">ç®¡ç†å‘˜</div>
                        <div class="role-desc">ç”¨æˆ·ç®¡ç†ã€æƒé™å®¡æ ¸ã€æ•°æ®å¯¼å‡ºã€ç³»ç»Ÿè®¾ç½®ã€å…¨å±€æ•°æ®æŸ¥çœ‹</div>
                    </div>
                </div>
                
                <button class="btn btn-primary" onclick="confirmRole()" id="confirmRoleBtn" disabled>
                    ç¡®è®¤è¿›å…¥ç³»ç»Ÿ
                </button>
            </div>
        </div>

        <!-- ä¸»ç•Œé¢ -->
        <div id="mainPage" class="content hidden">
            <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
            <div class="user-info">
                <h3 id="userRoleTitle">ğŸ‘¨â€ğŸ’¼ æ™®é€šç”¨æˆ·å·¥ä½œå°</h3>
                <div class="user-detail">
                    <span class="label">ç”¨æˆ·èº«ä»½ï¼š</span>
                    <span class="value" id="userRoleText">æ™®é€šç”¨æˆ·</span>
                </div>
                <div class="user-detail">
                    <span class="label">æƒé™èŒƒå›´ï¼š</span>
                    <span class="value" id="userPermissions">è®¾å¤‡æŠ¥ä¿®ã€è¿›åº¦æŸ¥è¯¢</span>
                </div>
                <div class="user-detail">
                    <span class="label">ç™»å½•æ—¶é—´ï¼š</span>
                    <span class="value" id="loginTime">--</span>
                </div>
            </div>

            <!-- åŠŸèƒ½åŒºåŸŸ -->
            <div id="functionArea">
                <!-- åŠŸèƒ½å¡ç‰‡ä¼šæ ¹æ®è§’è‰²åŠ¨æ€ç”Ÿæˆ -->
            </div>

            <!-- ç»Ÿè®¡æ•°æ® -->
            <div class="stats-section">
                <div class="stats-title" id="statsTitle">ğŸ“Š æˆ‘çš„ç»Ÿè®¡</div>
                <div class="stats-grid" id="statsGrid">
                    <!-- ç»Ÿè®¡æ•°æ®ä¼šæ ¹æ®è§’è‰²åŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>

            <!-- æœ€è¿‘è®°å½• -->
            <div class="list-section" id="recentSection">
                <div class="list-header" id="recentTitle">ğŸ“ æœ€è¿‘æ´»åŠ¨</div>
                <div id="recentList">
                    <!-- æœ€è¿‘è®°å½•ä¼šåŠ¨æ€åŠ è½½ -->
                </div>
            </div>
        </div>

        <!-- åº•éƒ¨å¯¼èˆª -->
        <div class="bottom-nav" id="bottomNav" style="display: none;">
            <div class="nav-item active" onclick="showPage('home')">
                <span class="nav-icon">ğŸ </span>
                <div class="nav-label">é¦–é¡µ</div>
            </div>
            <div class="nav-item" onclick="showPage('work')">
                <span class="nav-icon">ğŸ’¼</span>
                <div class="nav-label" id="workLabel">å·¥ä½œ</div>
            </div>
            <div class="nav-item" onclick="showPage('records')">
                <span class="nav-icon">ğŸ“‹</span>
                <div class="nav-label">è®°å½•</div>
            </div>
            <div class="nav-item" onclick="showPage('profile')">
                <span class="nav-icon">ğŸ‘¤</span>
                <div class="nav-label">æˆ‘çš„</div>
            </div>
        </div>
    </div>

    <!-- è®¾å¤‡æŠ¥ä¿®å¼¹çª— -->
    <div id="repairModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">ğŸ”§ è®¾å¤‡æ•…éšœæŠ¥ä¿®</div>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">è®¾å¤‡ç±»å‹</label>
                    <select class="form-select" id="deviceType">
                        <option value="">è¯·é€‰æ‹©è®¾å¤‡ç±»å‹</option>
                        <option value="åŒ…è£…è®¾å¤‡">åŒ…è£…è®¾å¤‡</option>
                        <option value="ç”Ÿäº§è®¾å¤‡">ç”Ÿäº§è®¾å¤‡</option>
                        <option value="æ£€æµ‹è®¾å¤‡">æ£€æµ‹è®¾å¤‡</option>
                        <option value="è¾“é€è®¾å¤‡">è¾“é€è®¾å¤‡</option>
                        <option value="å…¶ä»–è®¾å¤‡">å…¶ä»–è®¾å¤‡</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">è®¾å¤‡ç¼–å·</label>
                    <input type="text" class="form-input" id="deviceId" placeholder="å¦‚ï¼šPKG-001">
                </div>
                <div class="form-group">
                    <label class="form-label">æ•…éšœç±»å‹</label>
                    <select class="form-select" id="faultType">
                        <option value="">è¯·é€‰æ‹©æ•…éšœç±»å‹</option>
                        <option value="æœºæ¢°æ•…éšœ">æœºæ¢°æ•…éšœ</option>
                        <option value="ç”µæ°”æ•…éšœ">ç”µæ°”æ•…éšœ</option>
                        <option value="è½¯ä»¶æ•…éšœ">è½¯ä»¶æ•…éšœ</option>
                        <option value="å…¶ä»–æ•…éšœ">å…¶ä»–æ•…éšœ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">ç´§æ€¥ç¨‹åº¦</label>
                    <select class="form-select" id="urgency">
                        <option value="">è¯·é€‰æ‹©ç´§æ€¥ç¨‹åº¦</option>
                        <option value="ä½">ä½ - ä¸å½±å“ç”Ÿäº§</option>
                        <option value="ä¸­">ä¸­ - ç•¥å¾®å½±å“ç”Ÿäº§</option>
                        <option value="é«˜">é«˜ - ä¸¥é‡å½±å“ç”Ÿäº§</option>
                        <option value="ç´§æ€¥">ç´§æ€¥ - å®Œå…¨åœäº§</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">æ•…éšœæè¿°</label>
                    <textarea class="form-textarea" id="faultDescription" placeholder="è¯·è¯¦ç»†æè¿°æ•…éšœç°è±¡ã€å‘ç”Ÿæ—¶é—´ã€å¯èƒ½åŸå› ç­‰..."></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">æŠ¥ä¿®äºº</label>
                    <input type="text" class="form-input" id="reporter" placeholder="æ‚¨çš„å§“å">
                </div>
                <div class="form-group">
                    <label class="form-label">è”ç³»æ–¹å¼</label>
                    <input type="tel" class="form-input" id="contact" placeholder="æ‰‹æœºå·æˆ–åˆ†æœºå·">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hideModal('repairModal')">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="submitRepair()">æäº¤æŠ¥ä¿®</button>
            </div>
        </div>
    </div>

    <!-- æƒé™ç”³è¯·å¼¹çª— -->
    <div id="permissionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">ğŸ“ æƒé™ç”³è¯·</div>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">ç”³è¯·è§’è‰²</label>
                    <select class="form-select" id="targetRole">
                        <option value="">è¯·é€‰æ‹©ç”³è¯·çš„è§’è‰²</option>
                        <option value="maintainer">ç»´ä¿®äººå‘˜</option>
                        <option value="admin">ç®¡ç†å‘˜</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">ç”³è¯·åŸå› </label>
                    <textarea class="form-textarea" id="applyReason" placeholder="è¯·è¯¦ç»†è¯´æ˜ç”³è¯·åŸå› ï¼Œå¦‚å·¥ä½œéœ€è¦ã€æŠ€èƒ½åŒ¹é…ç­‰..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hideModal('permissionModal')">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="submitPermissionApplication()">æäº¤ç”³è¯·</button>
            </div>
        </div>
    </div>

    <!-- è®¾å¤‡ç‚¹æ£€å¼¹çª— -->
    <div id="inspectionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">âœ… è®¾å¤‡ç‚¹æ£€</div>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">è®¾å¤‡ç¼–å·</label>
                    <input type="text" class="form-input" id="inspectionDeviceId" placeholder="å¦‚ï¼šPKG-001">
                </div>
                <div class="form-group">
                    <label class="form-label">ç‚¹æ£€ç±»å‹</label>
                    <select class="form-select" id="inspectionType">
                        <option value="">è¯·é€‰æ‹©ç‚¹æ£€ç±»å‹</option>
                        <option value="æ—¥å¸¸ç‚¹æ£€">æ—¥å¸¸ç‚¹æ£€</option>
                        <option value="å‘¨æœŸç‚¹æ£€">å‘¨æœŸç‚¹æ£€</option>
                        <option value="ä¸“é¡¹ç‚¹æ£€">ä¸“é¡¹ç‚¹æ£€</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">è®¾å¤‡çŠ¶æ€</label>
                    <select class="form-select" id="deviceStatus">
                        <option value="">è¯·é€‰æ‹©è®¾å¤‡çŠ¶æ€</option>
                        <option value="æ­£å¸¸">æ­£å¸¸</option>
                        <option value="å¼‚å¸¸">å¼‚å¸¸</option>
                        <option value="éœ€è¦ç»´ä¿®">éœ€è¦ç»´ä¿®</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">ç‚¹æ£€é¡¹ç›®</label>
                    <div style="font-size: 12px; color: #666; margin-bottom: 8px;">
                        è¯·å‹¾é€‰å·²å®Œæˆçš„ç‚¹æ£€é¡¹ç›®ï¼š
                    </div>
                    <label style="display: block; margin-bottom: 5px; font-weight: normal;">
                        <input type="checkbox" style="margin-right: 8px;"> å¤–è§‚æ£€æŸ¥
                    </label>
                    <label style="display: block; margin-bottom: 5px; font-weight: normal;">
                        <input type="checkbox" style="margin-right: 8px;"> è¿è¡Œå£°éŸ³
                    </label>
                    <label style="display: block; margin-bottom: 5px; font-weight: normal;">
                        <input type="checkbox" style="margin-right: 8px;"> æ¸©åº¦æ£€æŸ¥
                    </label>
                    <label style="display: block; margin-bottom: 5px; font-weight: normal;">
                        <input type="checkbox" style="margin-right: 8px;"> æ¶¦æ»‘æƒ…å†µ
                    </label>
                </div>
                <div class="form-group">
                    <label class="form-label">å¤‡æ³¨è¯´æ˜</label>
                    <textarea class="form-textarea" id="inspectionNotes" placeholder="è®°å½•ç‚¹æ£€è¿‡ç¨‹ä¸­å‘ç°çš„é—®é¢˜æˆ–å»ºè®®..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hideModal('inspectionModal')">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="submitInspection()">æäº¤ç‚¹æ£€</button>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let currentUser = {
            role: null,
            name: 'å¾®ä¿¡ç”¨æˆ·',
            openid: null
        };
        let selectedRole = null;
        let currentPage = 'home';

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initWechatJS();
            updateLoginTime();
        });

        // åˆå§‹åŒ–å¾®ä¿¡JS-SDK
        function initWechatJS() {
            // è¿™é‡Œéœ€è¦ä»åç«¯è·å–å¾®ä¿¡JS-SDKé…ç½®
            // wx.config({...});
            console.log('å¾®ä¿¡JS-SDKåˆå§‹åŒ–');
        }

        // è§’è‰²é€‰æ‹©
        function selectRole(role) {
            selectedRole = role;
            
            // ç§»é™¤æ‰€æœ‰é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.role-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // æ·»åŠ é€‰ä¸­çŠ¶æ€
            event.target.closest('.role-card').classList.add('selected');
            
            // å¯ç”¨ç¡®è®¤æŒ‰é’®
            document.getElementById('confirmRoleBtn').disabled = false;
        }

        // ç¡®è®¤è§’è‰²
        function confirmRole() {
            if (!selectedRole) return;
            
            currentUser.role = selectedRole;
            
            // éšè—è§’è‰²é€‰æ‹©é¡µé¢
            document.getElementById('roleSelectionPage').classList.add('hidden');
            
            // æ˜¾ç¤ºä¸»ç•Œé¢
            document.getElementById('mainPage').classList.remove('hidden');
            document.getElementById('bottomNav').style.display = 'flex';
            
            // åˆå§‹åŒ–ä¸»ç•Œé¢
            initMainPage();
        }

        // åˆå§‹åŒ–ä¸»ç•Œé¢
        function initMainPage() {
            const role = currentUser.role;
            let roleConfig = {};

            // æ ¹æ®è§’è‰²é…ç½®ç•Œé¢
            switch(role) {
                case 'user':
                    roleConfig = {
                        title: 'ğŸ‘¨â€ğŸ’¼ æ™®é€šç”¨æˆ·å·¥ä½œå°',
                        roleText: 'æ™®é€šç”¨æˆ·ï¼ˆè®¾å¤‡æ“ä½œå‘˜ï¼‰',
                        permissions: 'è®¾å¤‡æŠ¥ä¿®ã€è¿›åº¦æŸ¥è¯¢ã€è®¾å¤‡ç‚¹æ£€',
                        workLabel: 'æŠ¥ä¿®',
                        functions: [
                            { icon: 'ğŸ”§', title: 'æ•…éšœæŠ¥ä¿®', action: 'showRepairModal' },
                            { icon: 'ğŸ“‹', title: 'æˆ‘çš„æŠ¥ä¿®', action: 'showMyRepairs' },
                            { icon: 'âœ…', title: 'è®¾å¤‡ç‚¹æ£€', action: 'showInspectionModal' },
                            { icon: 'â¬†ï¸', title: 'ç”³è¯·æƒé™', action: 'showPermissionModal' }
                        ],
                        stats: [
                            { label: 'æŠ¥ä¿®æ¬¡æ•°', value: '12' },
                            { label: 'å¤„ç†ä¸­', value: '2' },
                            { label: 'å·²å®Œæˆ', value: '10' }
                        ]
                    };
                    break;
                    
                case 'maintainer':
                    roleConfig = {
                        title: 'ğŸ”§ ç»´ä¿®äººå‘˜å·¥ä½œå°',
                        roleText: 'ç»´ä¿®äººå‘˜',
                        permissions: 'ç»´ä¿®ä»»åŠ¡å¤„ç†ã€çŠ¶æ€æ›´æ–°ã€ä»»åŠ¡è½¬åŠ',
                        workLabel: 'ç»´ä¿®',
                        functions: [
                            { icon: 'ğŸ› ï¸', title: 'ç»´ä¿®ä»»åŠ¡', action: 'showMaintenanceTasks' },
                            { icon: 'ğŸ“‹', title: 'ä»»åŠ¡ç®¡ç†', action: 'showTaskManagement' },
                            { icon: 'âš™ï¸', title: 'ä¿å…»è®°å½•', action: 'showMaintenanceRecords' },
                            { icon: 'ğŸ”„', title: 'ä»»åŠ¡è½¬åŠ', action: 'showTaskTransfer' }
                        ],
                        stats: [
                            { label: 'å¾…å¤„ç†', value: '5' },
                            { label: 'å¤„ç†ä¸­', value: '3' },
                            { label: 'å·²å®Œæˆ', value: '28' }
                        ]
                    };
                    break;
                    
                case 'admin':
                    roleConfig = {
                        title: 'ğŸ‘¨â€ğŸ’» ç®¡ç†å‘˜å·¥ä½œå°',
                        roleText: 'ç³»ç»Ÿç®¡ç†å‘˜',
                        permissions: 'ç”¨æˆ·ç®¡ç†ã€æƒé™å®¡æ ¸ã€æ•°æ®å¯¼å‡ºã€ç³»ç»Ÿè®¾ç½®',
                        workLabel: 'ç®¡ç†',
                        functions: [
                            { icon: 'ğŸ‘¥', title: 'ç”¨æˆ·ç®¡ç†', action: 'showUserManagement' },
                            { icon: 'âœ…', title: 'æƒé™å®¡æ ¸', action: 'showPermissionAudit' },
                            { icon: 'ğŸ“Š', title: 'æ•°æ®ä¸­å¿ƒ', action: 'showDataCenter' },
                            { icon: 'âš™ï¸', title: 'ç³»ç»Ÿè®¾ç½®', action: 'showSystemSettings' }
                        ],
                        stats: [
                            { label: 'æ€»ç”¨æˆ·', value: '156' },
                            { label: 'å¾…å®¡æ ¸', value: '8' },
                            { label: 'ç³»ç»ŸçŠ¶æ€', value: 'æ­£å¸¸' }
                        ]
                    };
                    break;
            }

            // æ›´æ–°ç•Œé¢
            document.getElementById('userRoleTitle').textContent = roleConfig.title;
            document.getElementById('userRoleText').textContent = roleConfig.roleText;
            document.getElementById('userPermissions').textContent = roleConfig.permissions;
            document.getElementById('workLabel').textContent = roleConfig.workLabel;

            // ç”ŸæˆåŠŸèƒ½å¡ç‰‡
            generateFunctionCards(roleConfig.functions);
            
            // ç”Ÿæˆç»Ÿè®¡æ•°æ®
            generateStats(roleConfig.stats);
            
            // åŠ è½½æœ€è¿‘è®°å½•
            loadRecentRecords();
        }

        // ç”ŸæˆåŠŸèƒ½å¡ç‰‡
        function generateFunctionCards(functions) {
            const functionArea = document.getElementById('functionArea');
            functionArea.innerHTML = `
                <div class="function-grid">
                    ${functions.map(func => `
                        <div class="function-card" onclick="${func.action}()">
                            <span class="function-icon">${func.icon}</span>
                            <div class="function-title">${func.title}</div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // ç”Ÿæˆç»Ÿè®¡æ•°æ®
        function generateStats(stats) {
            const statsGrid = document.getElementById('statsGrid');
            statsGrid.innerHTML = stats.map(stat => `
                <div class="stat-item">
                    <span class="stat-number">${stat.value}</span>
                    <div class="stat-label">${stat.label}</div>
                </div>
            `).join('');
        }

        // åŠ è½½æœ€è¿‘è®°å½•
        function loadRecentRecords() {
            const role = currentUser.role;
            let records = [];

            // æ¨¡æ‹Ÿæ•°æ®
            switch(role) {
                case 'user':
                    records = [
                        { title: 'åŒ…è£…è®¾å¤‡PKG-001', desc: 'ä¼ é€å¸¦å¼‚å“é—®é¢˜', status: 'processing', time: '2å°æ—¶å‰' },
                        { title: 'æ£€æµ‹è®¾å¤‡CHK-002', desc: 'ä¼ æ„Ÿå™¨æ•…éšœ', status: 'completed', time: '1å¤©å‰' },
                        { title: 'ç”Ÿäº§è®¾å¤‡PRD-003', desc: 'æ¸©åº¦å¼‚å¸¸', status: 'pending', time: '2å¤©å‰' }
                    ];
                    break;
                case 'maintainer':
                    records = [
                        { title: 'ç»´ä¿®ä»»åŠ¡#RX001', desc: 'åŒ…è£…è®¾å¤‡ä¼ é€å¸¦ç»´ä¿®', status: 'processing', time: 'æ­£åœ¨å¤„ç†' },
                        { title: 'ç»´ä¿®ä»»åŠ¡#RX002', desc: 'æ£€æµ‹è®¾å¤‡æ ¡å‡†', status: 'pending', time: 'å¾…å¤„ç†' },
                        { title: 'ç»´ä¿®ä»»åŠ¡#RX003', desc: 'ç”Ÿäº§è®¾å¤‡ä¿å…»', status: 'completed', time: 'å·²å®Œæˆ' }
                    ];
                    break;
                case 'admin':
                    records = [
                        { title: 'æƒé™ç”³è¯·å®¡æ ¸', desc: 'ç”¨æˆ·å¼ ä¸‰ç”³è¯·ç»´ä¿®å‘˜æƒé™', status: 'pending', time: 'å¾…å®¡æ ¸' },
                        { title: 'ç³»ç»Ÿæ•°æ®å¤‡ä»½', desc: 'æ¯æ—¥è‡ªåŠ¨æ•°æ®å¤‡ä»½', status: 'completed', time: 'ä»Šæ—¥å®Œæˆ' },
                        { title: 'ç”¨æˆ·è´¦å·ç®¡ç†', desc: 'æ–°å¢3ä¸ªç”¨æˆ·è´¦å·', status: 'completed', time: 'æ˜¨æ—¥å®Œæˆ' }
                    ];
                    break;
            }

            const recentList = document.getElementById('recentList');
            if (records.length === 0) {
                recentList.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">ğŸ“</div>
                        <div>æš‚æ— æœ€è¿‘æ´»åŠ¨</div>
                    </div>
                `;
            } else {
                recentList.innerHTML = records.map(record => `
                    <div class="list-item">
                        <div class="item-title">${record.title}</div>
                        <div class="item-desc">${record.desc}</div>
                        <div class="item-meta">
                            <span class="status-badge status-${record.status}">${getStatusText(record.status)}</span>
                            <span>${record.time}</span>
                        </div>
                    </div>
                `).join('');
            }
        }

        // è·å–çŠ¶æ€æ–‡æœ¬
        function getStatusText(status) {
            const statusMap = {
                'pending': 'å¾…å¤„ç†',
                'processing': 'å¤„ç†ä¸­',
                'completed': 'å·²å®Œæˆ',
                'urgent': 'ç´§æ€¥'
            };
            return statusMap[status] || status;
        }

        // æ˜¾ç¤ºå¼¹çª—
        function showModal(modalId) {
            document.getElementById(modalId).classList.add('show');
        }

        // éšè—å¼¹çª—
        function hideModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }

        // åŠŸèƒ½å‡½æ•°
        function showRepairModal() {
            showModal('repairModal');
        }

        function showPermissionModal() {
            showModal('permissionModal');
        }

        function showInspectionModal() {
            showModal('inspectionModal');
        }

        function showMyRepairs() {
            alert('æˆ‘çš„æŠ¥ä¿®åŠŸèƒ½å¼€å‘ä¸­...');
        }

        function showMaintenanceTasks() {
            alert('ç»´ä¿®ä»»åŠ¡åŠŸèƒ½å¼€å‘ä¸­...');
        }

        function showTaskManagement() {
            alert('ä»»åŠ¡ç®¡ç†åŠŸèƒ½å¼€å‘ä¸­...');
        }

        function showMaintenanceRecords() {
            alert('ä¿å…»è®°å½•åŠŸèƒ½å¼€å‘ä¸­...');
        }

        function showTaskTransfer() {
            alert('ä»»åŠ¡è½¬åŠåŠŸèƒ½å¼€å‘ä¸­...');
        }

        function showUserManagement() {
            alert('ç”¨æˆ·ç®¡ç†åŠŸèƒ½å¼€å‘ä¸­...');
        }

        function showPermissionAudit() {
            alert('æƒé™å®¡æ ¸åŠŸèƒ½å¼€å‘ä¸­...');
        }

        function showDataCenter() {
            alert('æ•°æ®ä¸­å¿ƒåŠŸèƒ½å¼€å‘ä¸­...');
        }

        function showSystemSettings() {
            alert('ç³»ç»Ÿè®¾ç½®åŠŸèƒ½å¼€å‘ä¸­...');
        }

        // æäº¤æŠ¥ä¿®
        function submitRepair() {
            const data = {
                deviceType: document.getElementById('deviceType').value,
                deviceId: document.getElementById('deviceId').value,
                faultType: document.getElementById('faultType').value,
                urgency: document.getElementById('urgency').value,
                description: document.getElementById('faultDescription').value,
                reporter: document.getElementById('reporter').value,
                contact: document.getElementById('contact').value
            };

            // éªŒè¯è¡¨å•
            if (!data.deviceType || !data.deviceId || !data.faultType || !data.urgency || !data.description || !data.reporter || !data.contact) {
                alert('è¯·å¡«å†™å®Œæ•´çš„æŠ¥ä¿®ä¿¡æ¯');
                return;
            }

            // è¿™é‡Œåº”è¯¥è°ƒç”¨åç«¯æ¥å£æäº¤æ•°æ®
            console.log('æäº¤æŠ¥ä¿®æ•°æ®:', data);
            
            alert('æŠ¥ä¿®å•æäº¤æˆåŠŸï¼å·¥å•å·ï¼šRX' + Date.now());
            hideModal('repairModal');
            
            // æ¸…ç©ºè¡¨å•
            document.querySelectorAll('#repairModal input, #repairModal select, #repairModal textarea').forEach(input => {
                input.value = '';
            });
        }

        // æäº¤æƒé™ç”³è¯·
        function submitPermissionApplication() {
            const data = {
                targetRole: document.getElementById('targetRole').value,
                reason: document.getElementById('applyReason').value
            };

            if (!data.targetRole || !data.reason) {
                alert('è¯·å¡«å†™å®Œæ•´çš„ç”³è¯·ä¿¡æ¯');
                return;
            }

            // è¿™é‡Œåº”è¯¥è°ƒç”¨åç«¯æ¥å£æäº¤æ•°æ®
            console.log('æäº¤æƒé™ç”³è¯·:', data);
            
            alert('æƒé™ç”³è¯·æäº¤æˆåŠŸï¼è¯·ç­‰å¾…ç®¡ç†å‘˜å®¡æ ¸ã€‚');
            hideModal('permissionModal');
            
            // æ¸…ç©ºè¡¨å•
            document.getElementById('targetRole').value = '';
            document.getElementById('applyReason').value = '';
        }

        // æäº¤è®¾å¤‡ç‚¹æ£€
        function submitInspection() {
            const data = {
                deviceId: document.getElementById('inspectionDeviceId').value,
                type: document.getElementById('inspectionType').value,
                status: document.getElementById('deviceStatus').value,
                notes: document.getElementById('inspectionNotes').value,
                items: []
            };

            // è·å–é€‰ä¸­çš„ç‚¹æ£€é¡¹ç›®
            document.querySelectorAll('#inspectionModal input[type="checkbox"]:checked').forEach(checkbox => {
                data.items.push(checkbox.parentElement.textContent.trim());
            });

            if (!data.deviceId || !data.type || !data.status) {
                alert('è¯·å¡«å†™å®Œæ•´çš„ç‚¹æ£€ä¿¡æ¯');
                return;
            }

            // è¿™é‡Œåº”è¯¥è°ƒç”¨åç«¯æ¥å£æäº¤æ•°æ®
            console.log('æäº¤ç‚¹æ£€æ•°æ®:', data);
            
            alert('è®¾å¤‡ç‚¹æ£€è®°å½•æäº¤æˆåŠŸï¼');
            hideModal('inspectionModal');
            
            // æ¸…ç©ºè¡¨å•
            document.querySelectorAll('#inspectionModal input, #inspectionModal select, #inspectionModal textarea').forEach(input => {
                if (input.type === 'checkbox') {
                    input.checked = false;
                } else {
                    input.value = '';
                }
            });
        }

        // é¡µé¢åˆ‡æ¢
        function showPage(page) {
            currentPage = page;
            
            // æ›´æ–°å¯¼èˆªçŠ¶æ€
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.closest('.nav-item').classList.add('active');
            
            // æ ¹æ®é¡µé¢æ˜¾ç¤ºä¸åŒå†…å®¹
            console.log('åˆ‡æ¢åˆ°é¡µé¢:', page);
        }

        // æ›´æ–°ç™»å½•æ—¶é—´
        function updateLoginTime() {
            const now = new Date();
            const timeString = now.toLocaleString('zh-CN');
            document.getElementById('loginTime').textContent = timeString;
        }

        // é˜»æ­¢å¼¹çª—èƒŒæ™¯ç‚¹å‡»å…³é—­
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal')) {
                // å¯ä»¥é€‰æ‹©é˜»æ­¢å…³é—­æˆ–å…è®¸å…³é—­
                // e.target.classList.remove('show');
            }
        });
    </script>
</body>
</html> 